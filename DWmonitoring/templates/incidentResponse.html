{% extends 'base.html' %}
{% load static %}

{% block title %} Incident Response {% endblock title %}

{% block header %}
<header class="shadow-md py-2 px-4 flex justify-between items-center z-50">
    <a href="{% url 'incident-response'%}" class="text-xl font-extrabold text-gray-700">
        <div class="flex gap-2">
            <span class="items-center justify-center"><svg fill="#000000" width="30px" height="30px" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M14.9392 4C13.3569 4 11.8102 4.46919 10.4946 5.34824C9.17899 6.22729 8.15361 7.47672 7.54811 8.93853C6.94261 10.4003 6.78419 12.0089 7.09287 13.5607C7.40155 15.1126 8.16348 16.538 9.2823 17.6569C10.4011 18.7757 11.8266 19.5376 13.3784 19.8463C14.9303 20.155 16.5388 19.9965 18.0006 19.391C19.4624 18.7855 20.7119 17.7602 21.5909 16.4446C22.47 15.129 22.9391 13.5823 22.9391 12C22.9391 9.87827 22.0963 7.84344 20.596 6.34315C19.0957 4.84285 17.0609 4 14.9392 4ZM18.8591 14.8L17.7391 15.92C17.7019 15.9578 17.6576 15.9878 17.6086 16.0083C17.5597 16.0288 17.5072 16.0393 17.4541 16.0393C17.4011 16.0393 17.3486 16.0288 17.2997 16.0083C17.2507 15.9878 17.2064 15.9578 17.1691 15.92L14.4391 13.19C13.9127 13.3789 13.3413 13.404 12.8003 13.2619C12.2593 13.1199 11.7739 12.8174 11.4081 12.3942C11.0423 11.9711 10.8132 11.4471 10.7509 10.8912C10.6886 10.3353 10.7961 9.77363 11.0591 9.28L12.9391 11.14L14.0691 10.01L12.1891 8.14C12.6824 7.87185 13.2454 7.75989 13.8037 7.81897C14.362 7.87805 14.8892 8.10538 15.3154 8.47083C15.7415 8.83628 16.0466 9.3226 16.1902 9.86534C16.3337 10.4081 16.3089 10.9816 16.1192 11.51L18.8491 14.28C18.9111 14.3525 18.9452 14.4447 18.9452 14.54C18.9452 14.6353 18.9111 14.7275 18.8491 14.8H18.8591Z">
                        </path>
                        <path
                            d="M2.93915 12C2.94057 10.7604 3.32589 9.55167 4.04215 8.53995C4.75841 7.52824 5.77045 6.7632 6.93915 6.35V4.28C5.23585 4.73411 3.73023 5.73808 2.65623 7.13593C1.58223 8.53377 1 10.2472 1 12.01C1 13.7728 1.58223 15.4862 2.65623 16.8841C3.73023 18.2819 5.23585 19.2859 6.93915 19.74V17.65C5.76934 17.2373 4.75619 16.4722 4.03915 15.46C3.32396 14.4479 2.9397 13.2393 2.93915 12Z">
                        </path>
                    </g>
                </svg></span>
            <span class="text-gray-800">Incident</span> <span class="text-red-500">Response
            </span>
        </div>
    </a>
    <div class="relative flex gap-4 px-4">
        <link rel="shortcut icon" href="/static/images/monitoring.png" type="image/x-icon">
        <button
            class="hidden md:block border-2 border-gray-400 bg-gray-100 rounded-full p-2 {% if request.path == '/profile' %} border-red-600 {% endif %}"
            onclick="toggleDropdown('profileDropdown')">
            <img height="20" width="20" src="https://img.icons8.com/?size=100&id=fJ7hcfUGpKG7&format=png&color=000000"
                alt="profile " />
        </button>
        <div id="profileDropdown"
            class="hidden absolute right-0 mt-14 w-48 bg-white border border-gray-200 rounded-md shadow-lg py-1">
            <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Profile</a>
            <button onclick="showPopUp()"
                class="w-full text-left block px-4 py-2 text-gray-800 hover:bg-gray-100">Logout</button>
        </div>
        <div class="md:hidden block  bg-gray-100 rounded-full p-2  z-50">
            <input id="checkbox2" type="checkbox" class="hidden">
            <label class="toggle toggle2" for="checkbox2" onclick="toggleSidebar()">
                <div id="bar4" class="bars"></div>
                <div id="bar5" class="bars"></div>
                <div id="bar6" class="bars"></div>
            </label>
        </div>
    </div>
</header>
{% endblock header %}

{% block content %}
<div class="container mx-auto">
    <section id="raise-ticket" class="rounded-lg p-6">
        {% if user %}
        <div class="flex items-center justify-between mb-8 bg-white p-4">
            <div class="w-2/3 text-gray-600 font-semibold">
                If you encounter any suspicious activities or potential threats, please raise a ticket. Our team
                will review and address it promptly.
            </div>
            <button onclick="showForm()" class="bg-gray-200 border-2 border-gray-400  text-gray-800 font-semibold py-2 px-4 rounded">Raise
                Ticket</button>
        </div>

        <div id="backgroundMask" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>

        <div id="ticketForm" class="hidden fixed inset-0 z-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-lg">
                <form method="POST" class="space-y-4" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div>
                        <label for="ticket_title" class="block text-sm font-medium text-gray-700">Ticket Title</label>
                        <input type="text" id="ticket_title" name="ticket_title"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            required>
                    </div>
                    <div>
                        <label for="ticket_description"
                            class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="ticket_description" name="ticket_description" rows="3"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            required></textarea>
                    </div>
                    <div>
                        <label for="image" class="block text-sm font-medium text-gray-700">Image</label>
                        <input type="file" id="image" name="image"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div class="flex justify-end">
                        <button type="button" onclick="hideForm()"
                            class="bg-gray-500 text-white px-4 py-2 rounded-lg mr-2 hover:bg-gray-600">Cancel</button>
                        <button type="submit"
                            class="inline-block bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Raise
                            Ticket</button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        <div>
            <h2 class="text-xl font-bold text-gray-900 mb-4">Raised Tickets</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for ticket in tickets %}
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-4">
                        <h3 class="text-lg font-medium text-gray-900">{{ ticket.ticket_title }}</h3>
                        <p class="text-gray-500 mb-3">{{ ticket.ticket_description }}</p>
                        {% if ticket.image %}
                        <div class="max-w-[200px] ">
                            <span class="text-gray-600 ">Attachments</span>
                            <div>
                                <img src="{{ ticket.image.url }}" alt="Ticket Image"
                                    class="rounded-md w-full h-auto object-cover">
                                <a target="_blank"
                                    class=" border-2 rounded-lg flex gap-2 mt-1 items-center w-fit bg-gray-100 border-gray-400 px-2 "
                                    href="{{ ticket.image.url }}"> <img src="/static/images/redirect.png" width="12"
                                        height="12" alt=""> View image </a>
                            </div>
                        </div>
                        {% endif %}
                        <div class="mt-4 ">
                            <span class="text-gray-600 font-semibold">status:</span>
                            <div class="flex justify-between items-center">
                                {% if not ticket.resolved %}
                                <div class="text-white bg-yellow-600 w-10 text-xs rounded p-1 mt-1">
                                    <p>Open</p>
                                </div>
                                {% if user.is_staff %}
                                <form action="{% url 'resolve_ticket' ticket.ticket_id %}" method="POST">
                                    {% csrf_token %}
                                    <button type="submit"
                                        class="text-white bg-blue-500 w-30 text-xs rounded p-1 mt-1 hover:bg-blue-600">Mark
                                        as
                                        Resolved</button>
                                </form>
                                {% endif %}
                                {% else %}
                                <div class="text-white bg-green-500 w-14 text-xs rounded p-1 mt-1">
                                    <p>Resolved</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </section>
    <hr class="border-t border-gray-600 my-3">
    <div>
        <div class="px-6 mt-4">
            <div class="text-xl font-semibold">Integration With Security Infrastructure - <span
                    class="text-red-600">SIEM</span> </div>
            <div class="flex w-fit gap-4 font-semibold text-sm mt-2 ">
                <span class="bg-green-500 text-white rounded  px-4 ">Available on Demand</span>
                <a target="_blank" href="https://gkavach.com">
                    <div class="bg-gray-400 px-3 rounded text-gray-100 "> Learn more </div>
                </a>
            </div>
        </div>
        <div class="mt-2 flex-col w-full p-4 gap-4 flex md:flex-row">
            <div class="w-full  md:w-3/4 border-2 border-red-700 shadow-2xl rounded overflow-hidden"><img
                    src="/static/images/siem.png" alt="SIEM Image"
                    class="transform hover:scale-105 transition-all duration-200 ease-in-out object-cover"></div>
            <div class="mb-2 text-center text-gray-500 w-full md:w-2/3">SIEM (Security Information and Event Management)
                is a
                robust
                cybersecurity solution that integrates Security Information Management (SIM) and Security Event
                Management (SEM) functionalities into a unified platform. SIM involves the collection, normalization,
                and analysis of security data from various sources, such as logs and events from networks, systems, and
                applications. On the other hand, SEM focuses on real-time monitoring and correlation of security events
                to detect and respond promptly to potential threats. Together, SIEM enables organizations to gain
                comprehensive visibility into their IT infrastructure, detect security incidents in real-time, and
                facilitate effective incident response and forensic investigations. By centralizing security data and
                providing advanced analytics capabilities, SIEM helps organizations enhance their security posture,
                comply with regulatory requirements, and mitigate risks effectively.
            </div>
        </div>
        <div class="mx-6 mb-4">
            <a target="_blank" href="https://www.gkavach.com/" class="text-blue-500 text-sm hover:underline">Learn more
                about SIEM</a>
        </div>
    </div>
</div>

<script>
    // function showForm() {
    //     let element = document.getElementById("ticketForm");

    //     if (element.classList.contains('hidden')) {
    //         element.classList.remove('hidden');
    //         element.classList.add('block');
    //     } else {
    //         element.classList.remove('block');
    //         element.classList.add('hidden');
    //     }
    // }

    function showForm() {
        document.getElementById('ticketForm').classList.remove('hidden');
        document.getElementById('backgroundMask').classList.remove('hidden');
    }

    function hideForm() {
        document.getElementById('ticketForm').classList.add('hidden');
        document.getElementById('backgroundMask').classList.add('hidden');
    }
</script>
{% endblock content %}